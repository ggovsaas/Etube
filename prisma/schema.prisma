generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String              @id @default(cuid())
  name               String?
  email              String              @unique
  emailVerified      DateTime?           // Auth.js uses DateTime? for emailVerified
  image              String?              // Profile image URL for Auth.js
  password           String?             // Optional for OAuth users
  role               Role                @default(USER)
  isPro              Boolean             @default(false)
  proUntil           DateTime?
  credits            Int                 @default(0)
  verificationToken  String?             // Legacy verification token (can be removed later)
  verificationExpiry DateTime?           // Legacy verification expiry (can be removed later)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  // Auth.js relations
  accounts           Account[]
  sessions           Session[]
  // Existing app relations
  creditTransactions CreditTransaction[]
  favorites          Favorite[]
  listings           Listing[]
  profile            Profile?
  questions          Question[]
  reviews            Review[]
  subscriptions      Subscription[]
}

model Profile {
  id               String   @id @default(cuid())
  userId           String   @unique
  name             String
  age              Int
  city             String
  neighborhood     String?
  description      String?
  bio              String?
  location         String?
  phone            String?
  whatsappEnabled  Boolean  @default(false)
  telegramEnabled  Boolean  @default(false)
  onlyfans         String?
  privacy          String?
  instagram        String?
  twitter          String?
  tiktok           String?
  snapchat         String?
  telegramChannel  String?
  whatsappBusiness String?
  manyvids         String?
  chaturbate       String?
  myfreecams       String?
  livejasmin       String?
  linkHubUrl       String?
  gender           String?
  preference       String?
  weight           String?
  height           String?
  ethnicity        String?
  eyeColor         String?
  shoeSize         String?
  tattoos          String?
  piercings        String?
  smoker           String?
  languages        String?
  bodyType         String?
  hairColor        String?
  breastSize       String?
  breastType       String?
  personalityTags  String[]
  isVerified       Boolean  @default(false)
  isOnline         Boolean  @default(false)
  rating           Float    @default(0)
  profilePhoto     String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  hair             String?
  media            Media[]
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  reviews          Review[]
}

model Listing {
  id              String        @id @default(cuid())
  title           String
  description     String
  price           Float?
  location        String
  city            String
  age             Int
  phone           String
  services        String?
  minDuration     String?
  advanceNotice   String?
  acceptsCard     Boolean       @default(false)
  regularDiscount String?
  status          ListingStatus @default(ACTIVE)
  isPremium       Boolean       @default(false)
  isTurbo         Boolean       @default(false)
  isSuperTurbo    Boolean       @default(false)
  expiresAt       DateTime      @default(dbgenerated("(now() + '7 days'::interval)"))
  autoRenew       Boolean       @default(false)
  boostUntil      DateTime?
  userId          String
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  images          Image[]
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  media           Media[]
}

model Image {
  id        String   @id @default(cuid())
  url       String
  listingId String
  createdAt DateTime @default(now())
  listing   Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)
}

model Review {
  id         String   @id @default(cuid())
  rating     Int
  comment    String?
  authorName String?
  profileId  String
  userId     String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  profile    Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Media {
  id        String    @id @default(cuid())
  url       String
  type      MediaType
  profileId String?
  listingId String?
  createdAt DateTime  @default(now())
  listing   Listing?  @relation(fields: [listingId], references: [id], onDelete: Cascade)
  profile   Profile?  @relation(fields: [profileId], references: [id], onDelete: Cascade)
}

model Question {
  id        String   @id @default(cuid())
  question  String
  answer    String?
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Favorite {
  id        String   @id @default(cuid())
  userId    String
  listingId String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Subscription {
  id                 String             @id @default(cuid())
  userId             String
  type               SubscriptionType
  status             SubscriptionStatus @default(ACTIVE)
  stripeId           String?
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  cancelAtPeriodEnd  Boolean            @default(false)
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  user               User               @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CreditTransaction {
  id          String                @id @default(cuid())
  userId      String
  type        CreditTransactionType
  amount      Int
  description String
  stripeId    String?
  createdAt   DateTime              @default(now())
  user        User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum Role {
  USER
  ESCORT
  ADMIN
}

enum MediaType {
  PHOTO
  VIDEO
  IMAGE
}

enum ListingStatus {
  PENDING
  ACTIVE
  INACTIVE
  FINISHED
  EXPIRED
}

enum SubscriptionType {
  PRO_1_MONTH
  PRO_3_MONTHS
  PRO_6_MONTHS
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  PAST_DUE
  UNPAID
}

enum CreditTransactionType {
  PURCHASE
  USAGE
  REFUND
  BONUS
}

// Auth.js/NextAuth.js models
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}
